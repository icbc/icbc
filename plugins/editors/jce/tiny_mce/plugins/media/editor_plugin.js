(function(){var each=tinymce.each;tinymce.create('tinymce.plugins.MediaPlugin',{init:function(ed,url){var t=this;this.mimes={};(function(data){var items=data.split(/,/),i,y,ext;for(i=0;i<items.length;i+=2){ext=items[i+1].split(/ /);for(y=0;y<ext.length;y++)t.mimes[ext[y]]=items[i]}})("application/pdf,pdf,"+"application/x-shockwave-flash,swf swfl,"+"audio/mpeg,mpga mpega mp2 mp3,"+"audio/ogg,ogg,"+"audio/x-wav,wav,"+"video/mpeg,mpeg mpg mpe mp4,"+"video/ogg,ogg,"+"video/quicktime,qt mov,"+"video/x-flv,flv,"+"video/vnd.rn-realvideo,rv");t.editor=ed;t.url=url;function isMediaElm(n){return/mceItem(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia|DivX|Silverlight|Audio|Video|Generic)/.test(n.className)};ed.onPreInit.add(function(){ed.serializer.addRules('param[name|value|_mce_value]')});ed.onNodeChange.add(function(ed,cm,n){cm.setActive('media',n.nodeName=='IMG'&&isMediaElm(n))});ed.onInit.add(function(){ed.selection.onSetContent.add(function(){t._spansToImgs(ed.getBody())});ed.selection.onBeforeSetContent.add(t._objectsToSpans,t);if(ed.settings.content_css!==false)ed.dom.loadCSS(url+"/css/content.css")});ed.onBeforeSetContent.add(t._objectsToSpans,t);ed.onSetContent.add(function(){t._spansToImgs(ed.getBody())});ed.onPreProcess.add(function(ed,o){var dom=ed.dom;if(o.set){t._spansToImgs(o.node);each(dom.select('IMG',o.node),function(n){if(isMediaElm(n)){var p=t._parse(n.title);dom.setAttrib(n,'width',dom.getAttrib(n,'width',p.width||100));dom.setAttrib(n,'height',dom.getAttrib(n,'height',p.height||100))}})}if(o.get){each(dom.select('IMG',o.node),function(n){if(isMediaElm(n)){var ci,cb,mt;if(ed.getParam('media_use_script')){n.className=n.className.replace(/mceItem/g,'mceTemp');return}ed.dom.removeClass(n,'mceItemObject');switch(n.className){case'mceItemFlash':ci='d27cdb6e-ae6d-11cf-96b8-444553540000';cb='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version='+ed.getParam('media_version_flash','10,0,32,18');mt='application/x-shockwave-flash';break;case'mceItemShockWave':ci='166b1bca-3f9c-11cf-8075-444553540000';cb='http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version='+ed.getParam('media_version_shockwave','11,0,0,458');mt='application/x-director';break;case'mceItemWindowsMedia':ci='6bf52a52-394a-11d3-b153-00c04f79faa6';cb='http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version='+ed.getParam('media_version_windowsmedia','5,1,52,701');mt='application/x-mplayer2';break;case'mceItemQuickTime':ci='02bf25d5-8c17-4b23-bc80-d3488abddc6b';cb='http://www.apple.com/qtactivex/qtplugin.cab#version='+ed.getParam('media_version_quicktime','6,0,2,0');mt='video/quicktime';break;case'mceItemRealMedia':ci='cfcdaa03-8be4-11cf-b84b-0020afbbccfa';cb='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version='+ed.getParam('media_version_realplayer','7,0,0,0');mt='audio/x-pn-realaudio-plugin';break;case'mceItemDivX':ci='67dabfbf-d0ab-41fa-9c46-cc0f21721616';cb='http://go.divx.com/plugin/DivXBrowserPlugin.cab';mt='video/divx';break;case'mceItemPDF':ci='ca8a9780-280d-11cf-a24d-444553540000';cb='';mt='application/pdf';break;case'mceItemSilverlight':ci='';cb='';mt='application/x-silverlight-2';break}dom.replace(t._buildObj({classid:ci,codebase:cb,type:mt},n),n)}});dom.remove(dom.select('SPAN.mceItemObjectHTML',o.node))}});function getAttr(s,n){n=new RegExp(n+'=\"([^\"]+)\"','g').exec(s);return n?ed.dom.decode(n[1]):''};ed.onPostProcess.add(function(ed,o){o.content=o.content.replace(/_mce_value=/g,'value=');if(ed.getParam('media_use_script')){o.content=o.content.replace(/<img[^>]+>/g,function(im){var cl=getAttr(im,'class');if(/(mceTempFlash|mceTempShockWave|mceTempWindowsMedia|mceTempQuickTime|mceTempRealMedia|mceTempDivX|mceTempAudio|mceTempVideo)/.test(cl)){at=t._parse(getAttr(im,'title'));at.width=getAttr(im,'width');at.height=getAttr(im,'height');im=cl.replace(/[\s\S]*?mceTemp(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia|DivX|Silverlight|Audio|Video)[\s\S]*?/,function(a,b){return'<script type="text/javascript">JCEMediaObject.'+b.toLowerCase()+'({'+t._serialize(at)+'});</script>'})}return im})}})},getInfo:function(){return{longname:'Media',author:'Moxiecode Systems AB / Ryan Demmer',authorurl:'http://tinymce.moxiecode.com',infourl:'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media',version:tinymce.majorVersion+"."+tinymce.minorVersion}},_objectsToSpans:function(ed,o){var t=this,ed=t.editor,h=o.content;function ucfirst(s){return s.charAt(0).toUpperCase()+s.substring(1)}h=h.replace(/<script[^>]*>([\s\S]*?)(write|JCEMediaObject\.)(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia|DivX|Silverlight|Audio|Video)\(\{([^\)]*)\}\);([\s\S]*?)<\/script>/gi,function(a,b,c,d,e){var p=t._parse(e);return'<img class="mceItem'+ucfirst(d)+'" title="'+ed.dom.encode(e)+'" src="'+t.url+'/img/trans.gif" width="'+p.width+'" height="'+p.height+'" />'});h=h.replace(/<object([^>]*)>/gi,'<span class="mceItemObject" $1>');if(ed.getParam('media_html5',false)){h=h.replace(/<(audio|video)([^>]*)>/gi,function(a,b,c){return'<span class="mceItem'+ucfirst(b)+'"'+c+'>'})}h=h.replace(/<embed([^>]*)\/?>/gi,'<span class="mceItemEmbed" $1></span>');h=h.replace(/<embed([^>]*)>/gi,'<span class="mceItemEmbed" $1>');h=h.replace(/<\/(object|embed)([^>]*)>/gi,'</span>');if(ed.getParam('media_html5',false)){h=h.replace(/<\/(audio|video)([^>]*)>/gi,'</span>')}h=h.replace(/<param([^>]*)>/gi,function(a,b){return'<span '+b.replace(/value=/gi,'_mce_value=')+' class="mceItemParam"></span>'});h=h.replace(/\/ class=\"mceItemParam\"><\/span>/gi,'class="mceItemParam"></span>');o.content=h},_spansToImgs:function(p){var t=this,dom=t.editor.dom,mt,cl;each(dom.select('span.mceItemObject, span.mceItemEmbed, span.mceItemVideo, span.mceItemAudio',p),function(n){mt=dom.getAttrib(n,"classid")||dom.getAttrib(n,'type');var oh='';each(n.childNodes,function(el){if(/mceItem(Embed|Param)/.test(el.className))return;oh+=tinymce.trim(dom.getOuterHTML(el))});if(oh){dom.add(n,'span',{'class':'mceItemObjectHTML','style':'display:none;'},oh)}if(!mt&&n.className=='mceItemObject'){each(n.childNodes,function(c){if(dom.hasClass(c,'mceItemEmbed'))mt=dom.getAttrib(c,'type')})}if(mt)mt=mt.toLowerCase().replace(/\s+/g,'');switch(mt){case'clsid:d27cdb6e-ae6d-11cf-96b8-444553540000':case'application/x-shockwave-flash':cl='mceItemFlash';break;case'clsid:166b1bca-3f9c-11cf-8075-444553540000':case'application/x-director':cl='mceItemShockWave';break;case'clsid:6bf52a52-394a-11d3-b153-00c04f79faa6':case'clsid:22d6f312-b0f6-11d0-94ab-0080c74c7e95':case'clsid:05589fa1-c356-11ce-bf01-00aa0055595a':case'application/x-mplayer2':cl='mceItemWindowsMedia';break;case'clsid:02bf25d5-8c17-4b23-bc80-d3488abddc6b':case'video/quicktime':cl='mceItemQuickTime';break;case'clsid:cfcdaa03-8be4-11cf-b84b-0020afbbccfa':case'audio/x-pn-realaudio-plugin':cl='mceItemRealMedia';break;case'clsid:67dabfbf-d0ab-41fa-9c46-cc0f21721616':case'video/divx':cl='mceItemDivX';break;case'clsid:ca8a9780-280d-11cf-a24d-444553540000':case'application/pdf':cl='mceItemPDF';break;case'application/x-silverlight-2':cl='mceItemSilverlight';break;default:cl='mceItemGeneric';break}dom.replace(t._createImg(cl,n),n);return})},_createImg:function(cl,n){var t=this,im,dom=this.editor.dom,pa={},ti='';var id=dom.uniqueId(cl+'_');im=dom.create('img',{id:id,src:this.url+'/img/trans.gif',width:dom.getAttrib(n,'width')||100,height:dom.getAttrib(n,'height')||100,style:dom.getAttrib(n,'style'),'class':cl});dom.addClass(im,n.className);each(['bgcolor','align','border','vspace','hspace'],function(na){var v=dom.getAttrib(n,na);if(v){switch(na){case'bgcolor':dom.setStyle(im,'background-color',v);break;case'align':if(/^(left|right)$/.test(v)){dom.setStyle(im,'float',v)}else{dom.setStyle(im,'vertical-align',v)}break;case'vspace':dom.setStyle(im,'margin-top',v);dom.setStyle(im,'margin-bottom',v);break;case'hspace':dom.setStyle(im,'margin-left',v);dom.setStyle(im,'margin-right',v);break}}});var type=dom.getAttrib(n,'type'),src=dom.getAttrib(n,'src')||dom.getAttrib(n,'data');if(!type&&src){var ext;if(/\.([a-z0-9]{2,4})/.test(src)){ext=/\.([a-z0-9]{2,4})/.exec(src);ext=ext[1]||''}if(ext){pa.type=this.mimes[ext]}}if(/mceItemObject/.test(n.className)){each(['id','archive','codetype','declare','data','standby','type','usemap','lang','dir','tabindex','xml:lang'],function(na){var v=dom.getAttrib(n,na);if(v){pa[na]=v}});if(cl=='mceItemGeneric'){each(['type','classid','codebase','src'],function(na){var v=dom.getAttrib(n,na);if(v){pa[na]=v}})}}each(dom.select('span.mceItemParam',n),function(p){var k=dom.getAttrib(p,'name'),v=dom.getAttrib(p,'_mce_value');if(v){if(k=='flashvars'){v=t._escape(v)}pa[k]=v}});each(dom.select('span.mceItemObjectHTML',n),function(ih){dom.setAttrib(ih,'id',id+'_innerhtml');dom.insertAfter(ih,n)});if(pa.movie){pa.src=pa.movie;delete pa.movie}if(pa.source){pa.src=pa.source;delete pa.source}if(/mceItem(Audio|Video|Embed)/.test(n.className)){each(['title','type','autoplay','controls','loop','preload','src','contenteditable','contextmenu','draggable','hidden','item','itemprop','spellcheck','subject'],function(na){var v=dom.getAttrib(n,na);if(v){pa[na]=v}})}delete pa.width;delete pa.height;im.title=this._serialize(pa);return im},_buildObj:function(o,n){var ob,ed=this.editor,dom=ed.dom,p=this._parse(n.title),so,oh,html5,type;so=(ed.getParam('media_strict',true)&&o.type=='application/x-shockwave-flash')||o.type=='application/x-silverlight-2';html5=ed.getParam('media_html5',false)&&(/mceItem(Audio|Video|Embed)/.test(n.className)||(/mceItemEmbed/.test(n.className)&&n.parentNode.nodeName!='OBJECT'));type=o.type||'';p.width=o.width=dom.getAttrib(n,'width')||100;p.height=o.height=dom.getAttrib(n,'height')||100;var args=['title','id','lang','dir','tabindex','xml:lang'];if(p.src)p.src=ed.convertURL(p.src,'src',n);if(p.flashvars)p.flashvars=this._unescape(p.flashvars);if(!type&&p.src){var ext;if(/\.([a-z0-9]{2,4})/.test(p.src)){ext=/\.([a-z0-9]{2,4})/.exec(p.src);ext=ext[1]||''}if(ext){type=this.mimes[ext]}}var attribs={style:dom.getAttrib(n,'style'),width:o.width,height:o.height,type:type};if(!html5){tinymce.extend(attribs,{_mce_name:'object'});if(so){switch(o.type){case'application/x-silverlight-2':data='data:application/x-silverlight-2,';p.source=p.src;break;case'application/x-shockwave-flash':data=p.src;p.movie=p.src;break}tinymce.extend(attribs,{data:data})}else{var classid=o.classid||p.classid||'';if(classid&&!/clsid:/.test(classid)){classid='clsid:'+classid}tinymce.extend(attribs,{classid:classid,codebase:o.codebase||p.codebase||''});delete p.codebase;delete p.classid;args=args.concat(args,['archive','codetype','declare','data','standby','usemap'])}ob=dom.create('span',attribs);each(args,function(na){dom.setAttrib(ob,na,p[na]);delete(p[na])});each(p,function(v,k){if(!/^(width|height|type)$/.test(k)){if(o.type=='application/x-mplayer2'&&k=='src'&&!p.url)k='url';if(v)dom.add(ob,'span',{_mce_name:'param',name:k,'_mce_value':v})}});if(!so){if(p.url){p.src=p.url;delete p.url}dom.add(ob,'span',tinymce.extend(p,{_mce_name:'embed',type:type}))}}else{if(p.url){p.src=p.url;delete p.url}var name=n.className.match(/mceItem(Embed|Audio|Video)/);tinymce.extend(attribs,{_mce_name:name[1].toLowerCase(),src:p.src});args=args.concat(args,['autoplay','controls','loop','preload','contenteditable','contextmenu','draggable','hidden','item','itemprop','spellcheck','subject']);ob=dom.create('span',attribs);each(args,function(na){dom.setAttrib(ob,na,p[na])})}if(n.id){oh=dom.get(n.id+'_innerhtml');if(oh){ob.innerHTML=tinymce.trim(ob.innerHTML)+tinymce.trim(oh.innerHTML)}}return ob},_unescape:function(s){return decodeURIComponent(s).replace(/%27/g,"'")},_escape:function(s){return encodeURIComponent(s.replace(/'/g,'%27'))},_parse:function(s){return tinymce.util.JSON.parse('{'+s+'}')},_serialize:function(o){return tinymce.util.JSON.serialize(o).replace(/[{}]/g,'')}});tinymce.PluginManager.add('media',tinymce.plugins.MediaPlugin)})();